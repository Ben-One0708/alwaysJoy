<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase è¨­ç½®åŠ©æ‰‹</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .setup-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }

        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .step {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .step:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .step-number {
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .step-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #333;
        }

        .step-content {
            margin-left: 45px;
        }

        .config-form {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }

        .form-group input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .sql-code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 10px 0;
        }

        .copy-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        .copy-btn:hover {
            background: #5a6268;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-weight: 500;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .hidden {
            display: none;
        }

        .instructions {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
        }

        .instructions h4 {
            margin: 0 0 10px 0;
            color: #667eea;
        }

        .instructions ol {
            margin: 0;
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }
    </style>
</head>

<body>
    <div class="setup-container">
        <div class="header">
            <h1>ğŸš€ Supabase è¨­ç½®åŠ©æ‰‹</h1>
            <p>å¿«é€Ÿè¨­ç½®æ‚¨çš„æ‹¼å­—ç·´ç¿’å¹³å°è³‡æ–™åº«</p>
        </div>

        <div class="content">
            <!-- é€²åº¦æ¢ -->
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- æ­¥é©Ÿ1ï¼šé …ç›®å‰µå»º -->
            <div class="step" id="step1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">å‰µå»º Supabase é …ç›®</div>
                </div>
                <div class="step-content">
                    <div class="instructions">
                        <h4>ğŸ“‹ æ“ä½œæ­¥é©Ÿï¼š</h4>
                        <ol>
                            <li>å‰å¾€ <a href="https://supabase.com" target="_blank">Supabaseå®˜ç¶²</a></li>
                            <li>é»æ“Š "Start your project"</li>
                            <li>ä½¿ç”¨GitHubæˆ–Googleå¸³è™Ÿç™»å…¥</li>
                            <li>å‰µå»ºæ–°é …ç›®ï¼Œåç¨±ç‚º "alwaysjoy-education"</li>
                            <li>é¸æ“‡æœ€è¿‘çš„å€åŸŸï¼ˆå¦‚ Singapore æˆ– Tokyoï¼‰</li>
                            <li>è¨­ç½®å¼·å¯†ç¢¼ä¸¦è¨˜ä½å®ƒ</li>
                        </ol>
                    </div>
                    <button class="btn" onclick="nextStep(2)">é …ç›®å‰µå»ºå®Œæˆï¼Œä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- æ­¥é©Ÿ2ï¼šç²å–APIå¯†é‘° -->
            <div class="step hidden" id="step2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">ç²å– API å¯†é‘°</div>
                </div>
                <div class="step-content">
                    <div class="instructions">
                        <h4>ğŸ“‹ æ“ä½œæ­¥é©Ÿï¼š</h4>
                        <ol>
                            <li>åœ¨é …ç›®Dashboardä¸­é»æ“Šå·¦å´é¸å–®çš„ "Settings"</li>
                            <li>é»æ“Š "API" æ¨™ç±¤</li>
                            <li>è¤‡è£½ "Project URL" å’Œ "anon public key"</li>
                        </ol>
                    </div>

                    <div class="config-form">
                        <div class="form-group">
                            <label for="projectUrl">Project URL:</label>
                            <input type="text" id="projectUrl" placeholder="https://your-project-ref.supabase.co">
                        </div>
                        <div class="form-group">
                            <label for="anonKey">Anon Public Key:</label>
                            <input type="text" id="anonKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
                        </div>
                    </div>

                    <button class="btn" onclick="testConnection()">æ¸¬è©¦é€£æ¥</button>
                    <button class="btn btn-success" onclick="nextStep(3)">é€£æ¥æˆåŠŸï¼Œä¸‹ä¸€æ­¥</button>
                    <div id="connectionResult" class="result hidden"></div>
                </div>
            </div>

            <!-- æ­¥é©Ÿ3ï¼šè¨­ç½®è³‡æ–™åº«è¡¨ -->
            <div class="step hidden" id="step3">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">è¨­ç½®è³‡æ–™åº«è¡¨</div>
                </div>
                <div class="step-content">
                    <div class="instructions">
                        <h4>ğŸ“‹ æ“ä½œæ­¥é©Ÿï¼š</h4>
                        <ol>
                            <li>åœ¨Supabase Dashboardä¸­é»æ“Š "SQL Editor"</li>
                            <li>é»æ“Š "New query" å‰µå»ºæ–°æŸ¥è©¢</li>
                            <li>ä¾æ¬¡åŸ·è¡Œä»¥ä¸‹ä¸‰å€‹SQLè…³æœ¬</li>
                        </ol>
                    </div>

                    <h4>è…³æœ¬1ï¼šå‰µå»ºå­¸ç”Ÿè¡¨</h4>
                    <div class="sql-code">
                        <button class="copy-btn" onclick="copyToClipboard('studentsSQL')">è¤‡è£½</button>
                        <pre id="studentsSQL">-- å‰µå»ºå­¸ç”Ÿè¡¨
CREATE TABLE students (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL UNIQUE,
    password VARCHAR(100) NOT NULL,
    group_name VARCHAR(50) NOT NULL,
    level VARCHAR(20) NOT NULL,
    isAdmin BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- æ’å…¥é è¨­å­¸ç”Ÿè³‡æ–™
INSERT INTO students (name, password, group_name, level, isAdmin) VALUES
('C2 Yuni', 'Yuni', 'Bçµ„', 'C2', FALSE),
('C2 Emily', 'Emily', 'Bçµ„', 'C2', FALSE),
('A8 Vito', 'Vito', 'Bçµ„', 'A8', FALSE),
('A4 Eudora', 'Eudora', 'Cçµ„', 'A4', FALSE),
('A5 Zoe', 'Zoe', 'Cçµ„', 'A5', FALSE),
('N6 Bruce', 'Bruce', 'Dçµ„', 'N6', FALSE),
('N7 Laura', 'Laura', 'Dçµ„', 'N7', FALSE),
('K9 Lilian', 'Lilian', 'Eçµ„', 'K9', FALSE),
('K9 Jill', 'Jill', 'Eçµ„', 'K9', FALSE),
('I2 Candy', 'Candy', 'Fçµ„', 'I2', FALSE),
('N3 Avery', 'Avery', 'Fçµ„', 'N3', FALSE),
('æ•™å‹™çµ„ Annie', 'Annie', 'æ•™å‹™çµ„', 'Admin', FALSE),
('æ•™å‹™çµ„ Celina', 'Celina', 'æ•™å‹™çµ„', 'Admin', FALSE),
('æ•™å‹™çµ„ Nina', 'Nina', 'æ•™å‹™çµ„', 'Admin', FALSE),
('Ben', 'BenBenBen', 'ç®¡ç†å“¡', 'Admin', TRUE);</pre>
                    </div>

                    <h4>è…³æœ¬2ï¼šå‰µå»ºæˆç¸¾è¡¨</h4>
                    <div class="sql-code">
                        <button class="copy-btn" onclick="copyToClipboard('scoresSQL')">è¤‡è£½</button>
                        <pre id="scoresSQL">-- å‰µå»ºæˆç¸¾è¡¨
CREATE TABLE scores (
    id SERIAL PRIMARY KEY,
    studentName VARCHAR(100) NOT NULL,
    quizType VARCHAR(50) NOT NULL,
    score INTEGER NOT NULL,
    totalQuestions INTEGER NOT NULL,
    percentage INTEGER NOT NULL,
    date TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    details JSONB DEFAULT '{}',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å‰µå»ºç´¢å¼•
CREATE INDEX idx_scores_student_name ON scores(studentName);
CREATE INDEX idx_scores_quiz_type ON scores(quizType);
CREATE INDEX idx_scores_date ON scores(date);
CREATE INDEX idx_scores_student_date ON scores(studentName, date);</pre>
                    </div>

                    <h4>è…³æœ¬3ï¼šè¨­ç½®å®‰å…¨ç­–ç•¥</h4>
                    <div class="sql-code">
                        <button class="copy-btn" onclick="copyToClipboard('securitySQL')">è¤‡è£½</button>
                        <pre id="securitySQL">-- å•Ÿç”¨RLS
ALTER TABLE students ENABLE ROW LEVEL SECURITY;
ALTER TABLE scores ENABLE ROW LEVEL SECURITY;

-- å­¸ç”Ÿè¡¨ç­–ç•¥
CREATE POLICY "Students can view their own data" ON students
    FOR SELECT USING (name = current_user);

-- æˆç¸¾è¡¨ç­–ç•¥
CREATE POLICY "Students can view their own scores" ON scores
    FOR SELECT USING (studentName = current_user);

CREATE POLICY "Students can insert their own scores" ON scores
    FOR INSERT WITH CHECK (studentName = current_user);</pre>
                    </div>

                    <button class="btn" onclick="nextStep(4)">SQLè…³æœ¬åŸ·è¡Œå®Œæˆï¼Œä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- æ­¥é©Ÿ4ï¼šè¨­ç½®CORS -->
            <div class="step hidden" id="step4">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">è¨­ç½® CORS</div>
                </div>
                <div class="step-content">
                    <div class="instructions">
                        <h4>ğŸ“‹ æ“ä½œæ­¥é©Ÿï¼š</h4>
                        <ol>
                            <li>åœ¨Supabase Dashboardä¸­é»æ“Š "Settings" > "API"</li>
                            <li>æ‰¾åˆ° "CORS" éƒ¨åˆ†</li>
                            <li>æ·»åŠ ä»¥ä¸‹åŸŸåï¼š</li>
                        </ol>
                    </div>

                    <div class="sql-code">
                        <pre>https://your-username.github.io
http://localhost:3000
http://localhost:5500</pre>
                    </div>

                    <p><strong>æ³¨æ„ï¼š</strong>è«‹å°‡ <code>your-username</code> æ›¿æ›ç‚ºæ‚¨çš„GitHubç”¨æˆ¶å</p>

                    <button class="btn" onclick="nextStep(5)">CORSè¨­ç½®å®Œæˆï¼Œä¸‹ä¸€æ­¥</button>
                </div>
            </div>

            <!-- æ­¥é©Ÿ5ï¼šç”Ÿæˆé…ç½®æ–‡ä»¶ -->
            <div class="step hidden" id="step5">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <div class="step-title">ç”Ÿæˆé…ç½®æ–‡ä»¶</div>
                </div>
                <div class="step-content">
                    <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•ç”Ÿæˆæ‚¨çš„ <code>supabase-config.js</code> æ–‡ä»¶ï¼š</p>

                    <button class="btn btn-success" onclick="generateConfig()">ç”Ÿæˆé…ç½®æ–‡ä»¶</button>

                    <div id="configOutput" class="sql-code hidden">
                        <button class="copy-btn" onclick="copyToClipboard('configOutput')">è¤‡è£½é…ç½®</button>
                        <pre id="configContent"></pre>
                    </div>

                    <div class="instructions">
                        <h4>ğŸ“‹ å®Œæˆæ­¥é©Ÿï¼š</h4>
                        <ol>
                            <li>å°‡ç”Ÿæˆçš„é…ç½®è¤‡è£½åˆ° <code>supabase-config.js</code> æ–‡ä»¶ä¸­</li>
                            <li>ä½¿ç”¨ <a href="test-database.html" target="_blank">test-database.html</a> æ¸¬è©¦é€£æ¥</li>
                            <li>å¦‚æœæ¸¬è©¦æˆåŠŸï¼Œæ‚¨çš„è¨­ç½®å°±å®Œæˆäº†ï¼</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        let currentStep = 1;
        const totalSteps = 5;

        // æ›´æ–°é€²åº¦æ¢
        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        // åˆ‡æ›æ­¥é©Ÿ
        function nextStep(step) {
            // éš±è—ç•¶å‰æ­¥é©Ÿ
            document.getElementById('step' + currentStep).classList.add('hidden');

            // é¡¯ç¤ºæ–°æ­¥é©Ÿ
            document.getElementById('step' + step).classList.remove('hidden');

            currentStep = step;
            updateProgress();
        }

        // æ¸¬è©¦é€£æ¥
        async function testConnection() {
            const projectUrl = document.getElementById('projectUrl').value;
            const anonKey = document.getElementById('anonKey').value;
            const resultDiv = document.getElementById('connectionResult');

            if (!projectUrl || !anonKey) {
                showResult('error', 'è«‹å¡«å¯«Project URLå’ŒAnon Key');
                return;
            }

            showResult('info', 'æ­£åœ¨æ¸¬è©¦é€£æ¥...');

            try {
                const supabase = window.supabase.createClient(projectUrl, anonKey);
                const { data, error } = await supabase
                    .from('students')
                    .select('count')
                    .limit(1);

                if (error) {
                    throw error;
                }

                showResult('success', 'âœ… é€£æ¥æ¸¬è©¦æˆåŠŸï¼æ‚¨çš„Supabaseé…ç½®æ­£ç¢ºã€‚');
            } catch (error) {
                showResult('error', `âŒ é€£æ¥æ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
            }
        }

        // é¡¯ç¤ºçµæœ
        function showResult(type, message) {
            const resultDiv = document.getElementById('connectionResult');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = message;
            resultDiv.classList.remove('hidden');
        }

        // è¤‡è£½åˆ°å‰ªè²¼æ¿
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;

            navigator.clipboard.writeText(text).then(() => {
                // é¡¯ç¤ºè¤‡è£½æˆåŠŸæç¤º
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'å·²è¤‡è£½ï¼';
                btn.style.background = '#28a745';

                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#6c757d';
                }, 2000);
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—ï¼š', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½');
            });
        }

        // ç”Ÿæˆé…ç½®æ–‡ä»¶
        function generateConfig() {
            const projectUrl = document.getElementById('projectUrl').value;
            const anonKey = document.getElementById('anonKey').value;

            if (!projectUrl || !anonKey) {
                alert('è«‹å…ˆå¡«å¯«Project URLå’ŒAnon Key');
                return;
            }

            const config = `// Supabase é…ç½®
const SUPABASE_CONFIG = {
    PROJECT_URL: '${projectUrl}',
    ANON_KEY: '${anonKey}',
    REGION: 'ap-southeast-1',
    PROJECT_NAME: 'alwaysjoy-education'
};

if (typeof module !== 'undefined' && module.exports) {
    module.exports = SUPABASE_CONFIG;
} else {
    window.SUPABASE_CONFIG = SUPABASE_CONFIG;
}`;

            document.getElementById('configContent').textContent = config;
            document.getElementById('configOutput').classList.remove('hidden');
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            updateProgress();
        });
    </script>
</body>

</html>