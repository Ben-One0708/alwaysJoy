<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>診斷登入按鈕</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .debug-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .form-group {
            margin: 15px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .login-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        .login-btn:hover {
            background: #0056b3;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>

<body>
    <h1>🔧 診斷登入按鈕問題</h1>

    <div class="debug-container">
        <h2>📝 登入測試</h2>
        <div class="form-group">
            <label>帳號：</label>
            <input type="text" id="username" value="Joyloveyou" placeholder="請輸入帳號">
        </div>
        <div class="form-group">
            <label>密碼：</label>
            <input type="password" id="password" value="Joyloveyou" placeholder="請輸入密碼">
        </div>
        <button onclick="testLogin()" class="login-btn">測試登入 (onclick)</button>
        <button id="testBtn" class="login-btn">測試登入 (addEventListener)</button>
        <button onclick="console.log('按鈕被點擊了')" class="login-btn">測試基本點擊</button>
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <div class="debug-container">
        <h2>🔍 診斷資訊</h2>
        <button onclick="checkScripts()" class="login-btn">檢查腳本載入</button>
        <button onclick="checkFunctions()" class="login-btn">檢查函數定義</button>
        <button onclick="checkConsole()" class="login-btn">檢查控制台錯誤</button>
        <div id="debugResult" class="result" style="display: none;"></div>
    </div>

    <div class="debug-container">
        <h2>🔗 相關連結</h2>
        <p><a href="index.html" target="_blank">主網站</a></p>
        <p><a href="https://ben-one0708.github.io/alwaysJoy/" target="_blank">線上主網站</a></p>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="api-supabase-client.js"></script>
    <script src="script.js"></script>
    <script>
        // 測試登入函數
        function testLogin() {
            const resultDiv = document.getElementById('result');
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = '🔄 正在測試登入...';

            console.log('testLogin 函數被調用');
            console.log('帳號:', username);
            console.log('密碼:', password);

            // 模擬主網站的登入邏輯
            if (username === 'Joyloveyou' && password === 'Joyloveyou') {
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `✅ 登入成功！\n\n帳號：${username}\n密碼：${password}\n\n函數調用正常。`;
            } else {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `❌ 登入失敗！\n\n帳號：${username}\n密碼：${password}\n\n請確認帳號密碼都是 Joyloveyou。`;
            }
        }

        // 檢查腳本載入
        function checkScripts() {
            const resultDiv = document.getElementById('debugResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';

            let result = '📋 腳本載入檢查：\n\n';

            // 檢查 Supabase
            if (typeof supabase !== 'undefined') {
                result += '✅ Supabase 已載入\n';
            } else {
                result += '❌ Supabase 未載入\n';
            }

            // 檢查配置
            if (window.SUPABASE_CONFIG) {
                result += '✅ Supabase 配置已載入\n';
            } else {
                result += '❌ Supabase 配置未載入\n';
            }

            // 檢查 API 服務
            if (window.apiService) {
                result += '✅ API 服務已初始化\n';
            } else {
                result += '❌ API 服務未初始化\n';
            }

            // 檢查主登入函數
            if (typeof loginToSystem === 'function') {
                result += '✅ loginToSystem 函數已定義\n';
            } else {
                result += '❌ loginToSystem 函數未定義\n';
            }

            resultDiv.innerHTML = result;
        }

        // 檢查函數定義
        function checkFunctions() {
            const resultDiv = document.getElementById('debugResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';

            let result = '🔍 函數定義檢查：\n\n';

            const functions = [
                'loginToSystem',
                'setLoggedIn',
                'showMainContent',
                'showSuccessMessage',
                'logoutFromSystem',
                'showLoginPage'
            ];

            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    result += `✅ ${funcName} 已定義\n`;
                } else {
                    result += `❌ ${funcName} 未定義\n`;
                }
            });

            resultDiv.innerHTML = result;
        }

        // 檢查控制台錯誤
        function checkConsole() {
            const resultDiv = document.getElementById('debugResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';

            resultDiv.innerHTML = '📊 控制台檢查：\n\n請打開瀏覽器開發者工具 (F12)\n查看 Console 標籤是否有錯誤訊息\n\n常見問題：\n- 腳本載入失敗\n- 語法錯誤\n- 網路連接問題';
        }

        // 使用 addEventListener 綁定事件
        document.addEventListener('DOMContentLoaded', function () {
            const testBtn = document.getElementById('testBtn');
            if (testBtn) {
                testBtn.addEventListener('click', function () {
                    console.log('addEventListener 按鈕被點擊');
                    testLogin();
                });
            }

            console.log('頁面載入完成');
            console.log('loginToSystem 函數:', typeof loginToSystem);
        });

        // 捕獲全域錯誤
        window.addEventListener('error', function (e) {
            console.error('全域錯誤:', e.error);
            const resultDiv = document.getElementById('debugResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result error';
            resultDiv.innerHTML = `❌ 全域錯誤：${e.error.message}\n\n檔案：${e.filename}\n行號：${e.lineno}`;
        });
    </script>
</body>

</html>